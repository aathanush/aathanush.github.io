{"version":3,"file":"taiga-ui-kit-pipes-filter-by-input.mjs","sources":["../../../projects/kit/pipes/filter-by-input/filter-by-input.pipe.ts","../../../projects/kit/pipes/filter-by-input/taiga-ui-kit-pipes-filter-by-input.ts"],"sourcesContent":["import type {PipeTransform} from '@angular/core';\nimport {inject, Pipe} from '@angular/core';\nimport {TUI_DEFAULT_MATCHER} from '@taiga-ui/cdk/constants';\nimport type {TuiStringHandler, TuiStringMatcher} from '@taiga-ui/cdk/types';\nimport {tuiPure} from '@taiga-ui/cdk/utils/miscellaneous';\nimport {TUI_DATA_LIST_HOST} from '@taiga-ui/core/components/data-list';\nimport {TuiTextfieldComponent} from '@taiga-ui/core/components/textfield';\nimport type {TuiItemsHandlers} from '@taiga-ui/core/directives/items-handlers';\nimport {TUI_ITEMS_HANDLERS} from '@taiga-ui/core/directives/items-handlers';\nimport {tuiIsFlat} from '@taiga-ui/kit/utils';\n\n// TODO: Consider replacing TuiTextfieldComponent with proper token once we refactor textfields\n@Pipe({\n    standalone: true,\n    name: 'tuiFilterByInput',\n    pure: false,\n})\nexport class TuiFilterByInputPipe implements PipeTransform {\n    // TODO: Remove optional after legacy controls are dropped\n    private readonly textfield = inject(TuiTextfieldComponent, {optional: true});\n    private readonly host = inject(TUI_DATA_LIST_HOST);\n    private readonly itemsHandlers: TuiItemsHandlers<unknown> =\n        inject(TUI_ITEMS_HANDLERS);\n\n    public transform<T>(\n        items: ReadonlyArray<readonly T[]>,\n        matcher?: TuiStringMatcher<T>,\n    ): ReadonlyArray<readonly T[]>;\n    public transform<T>(items: readonly T[], matcher?: TuiStringMatcher<T>): readonly T[];\n    public transform<T>(\n        items: ReadonlyArray<readonly T[]> | null,\n        matcher?: TuiStringMatcher<T>,\n    ): ReadonlyArray<readonly T[]> | null;\n    public transform<T>(\n        items: readonly T[] | null,\n        matcher?: TuiStringMatcher<T>,\n    ): readonly T[] | null;\n    public transform<T>(\n        items: ReadonlyArray<readonly T[]> | readonly T[] | null,\n        matcher: TuiStringMatcher<T> = TUI_DEFAULT_MATCHER,\n    ): ReadonlyArray<readonly T[]> | readonly T[] | null {\n        return this.filter<T>(\n            items,\n            matcher,\n            (this.textfield\n                ? this.itemsHandlers.stringify()\n                : // TODO(v5): delete backward compatibility\n                  this.host.stringify) || String,\n            this.textfield?.input?.nativeElement.value ||\n                (this.host as any).nativeFocusableElement?.value ||\n                '',\n        );\n    }\n\n    @tuiPure\n    private filter<T>(\n        items: ReadonlyArray<readonly T[]> | readonly T[] | null,\n        matcher: TuiStringMatcher<T>,\n        stringify: TuiStringHandler<T>,\n        query: string,\n    ): ReadonlyArray<readonly T[]> | readonly T[] | null {\n        if (!items) {\n            return null;\n        }\n\n        return tuiIsFlat(items)\n            ? this.filterFlat(items, matcher, stringify, query)\n            : this.filter2d(items, matcher, stringify, query);\n    }\n\n    private filterFlat<T>(\n        items: readonly T[],\n        matcher: TuiStringMatcher<T>,\n        stringify: TuiStringHandler<T>,\n        query: string,\n    ): readonly T[] {\n        const match = this.getMatch(items, stringify, query);\n\n        return match != null\n            ? items\n            : items.filter((item) => matcher(item, query, stringify));\n    }\n\n    private filter2d<T>(\n        items: ReadonlyArray<readonly T[]>,\n        matcher: TuiStringMatcher<T>,\n        stringify: TuiStringHandler<T>,\n        query: string,\n    ): ReadonlyArray<readonly T[]> {\n        const match = items.find((item) => this.getMatch(item, stringify, query) != null);\n\n        return match != null\n            ? items\n            : items.map((inner) => this.filterFlat(inner, matcher, stringify, query));\n    }\n\n    private getMatch<T>(\n        items: readonly T[],\n        stringify: TuiStringHandler<T>,\n        query: string,\n    ): T | undefined {\n        // TODO: Refactor when tui-textfield[multi] is ready\n        if ((this.host as any).tagValidator) {\n            return undefined;\n        }\n\n        return items.find(\n            (item) => stringify(item).toLocaleLowerCase() === query.toLocaleLowerCase(),\n        );\n    }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}