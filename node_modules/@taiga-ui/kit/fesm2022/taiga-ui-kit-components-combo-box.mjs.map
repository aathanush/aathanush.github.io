{"version":3,"file":"taiga-ui-kit-components-combo-box.mjs","sources":["../../../projects/kit/components/combo-box/combo-box.directive.ts","../../../projects/kit/components/combo-box/taiga-ui-kit-components-combo-box.ts"],"sourcesContent":["import {Directive, effect, inject, Input, untracked} from '@angular/core';\nimport {tuiAsControl, TuiControl} from '@taiga-ui/cdk/classes';\nimport {TUI_ALLOW_SIGNAL_WRITES, TUI_STRICT_MATCHER} from '@taiga-ui/cdk/constants';\nimport type {TuiStringMatcher} from '@taiga-ui/cdk/types';\nimport {tuiInjectElement} from '@taiga-ui/cdk/utils/dom';\nimport {tuiIsString} from '@taiga-ui/cdk/utils/miscellaneous';\nimport type {TuiDataListAccessor} from '@taiga-ui/core/components/data-list';\nimport {tuiAsOptionContent} from '@taiga-ui/core/components/data-list';\nimport type {TuiTextfieldAccessor} from '@taiga-ui/core/components/textfield';\nimport {\n    tuiAsTextfieldAccessor,\n    tuiInjectAuxiliary,\n    TuiTextfieldComponent,\n    TuiTextfieldDirective,\n    TuiWithTextfield,\n} from '@taiga-ui/core/components/textfield';\nimport {\n    TuiDropdownDirective,\n    tuiDropdownEnabled,\n    tuiDropdownOpen,\n} from '@taiga-ui/core/directives/dropdown';\nimport type {TuiItemsHandlers} from '@taiga-ui/core/directives/items-handlers';\nimport {TUI_ITEMS_HANDLERS} from '@taiga-ui/core/directives/items-handlers';\nimport {tuiAsAuxiliary} from '@taiga-ui/core/tokens';\nimport {TuiSelectOption} from '@taiga-ui/kit/components/select';\n\n@Directive({\n    standalone: true,\n    selector: 'input[tuiComboBox]',\n    providers: [\n        tuiAsOptionContent(TuiSelectOption),\n        tuiAsTextfieldAccessor(TuiComboBox),\n        tuiAsControl(TuiComboBox),\n        tuiAsAuxiliary(TuiComboBox),\n    ],\n    hostDirectives: [TuiWithTextfield],\n    host: {\n        '[disabled]': 'disabled()',\n        '(blur)': 'onTouched()',\n        '(click)': 'toggleDropdown()',\n        '(input)': 'onInput($event.target.value)',\n        '(keydown.enter)': 'keydownEnter($event)',\n    },\n})\nexport class TuiComboBox<T>\n    extends TuiControl<T | string | null>\n    implements TuiTextfieldAccessor<T>\n{\n    private readonly el = tuiInjectElement<HTMLInputElement>();\n    private readonly host: TuiTextfieldComponent<T> = inject(TuiTextfieldComponent);\n    private readonly textfield: TuiTextfieldDirective<T> = inject(TuiTextfieldDirective);\n\n    private readonly open = tuiDropdownOpen();\n    private readonly dropdown = inject(TuiDropdownDirective);\n    private readonly itemsHandlers: TuiItemsHandlers<T> = inject(TUI_ITEMS_HANDLERS);\n    private readonly datalist = tuiInjectAuxiliary<TuiDataListAccessor<T>>(\n        (x) => 'getOptions' in x,\n    );\n\n    protected readonly dropdownEnabled = tuiDropdownEnabled(this.interactive);\n\n    protected readonly valueEffect = effect(() => {\n        const value = this.value() ?? '';\n        const stringified = tuiIsString(value)\n            ? value\n            : this.itemsHandlers.stringify()(value);\n        const match = this.match(stringified);\n\n        this.textfield.value.update((x) => stringified || x);\n\n        if (match) {\n            setTimeout((end = this.el.value.length) =>\n                this.el.setSelectionRange(end, end),\n            );\n        }\n    }, TUI_ALLOW_SIGNAL_WRITES);\n\n    protected readonly blurEffect = effect(() => {\n        const value = untracked(() => this.value());\n\n        if (!this.host.focused() && this.strict && !value) {\n            this.textfield.value.set('');\n        }\n    }, TUI_ALLOW_SIGNAL_WRITES);\n\n    @Input()\n    public strict = true;\n\n    @Input()\n    public matcher: TuiStringMatcher<T> | null = TUI_STRICT_MATCHER;\n\n    public setValue(value: T): void {\n        this.onChange(value);\n\n        if (!value) {\n            this.toggleDropdown(true);\n            this.textfield.value.set('');\n        }\n    }\n\n    protected toggleDropdown(open = !this.open()): void {\n        if (this.dropdownEnabled() && this.dropdown.content) {\n            this.open.set(open);\n        }\n    }\n\n    protected onInput(value: string): void {\n        const match = this.match(value);\n        const fallback = this.strict || !value ? null : value;\n\n        this.onChange(match ?? fallback);\n        setTimeout(() => this.toggleDropdown(true));\n    }\n\n    protected keydownEnter(event: KeyboardEvent): void {\n        if (!this.open()) {\n            return;\n        }\n\n        event.preventDefault();\n\n        if (this.options.length === 1) {\n            this.onChange(this.options[0]!);\n            this.toggleDropdown(false);\n        }\n    }\n\n    private get options(): readonly T[] {\n        return this.datalist()?.getOptions() || [];\n    }\n\n    private match(value: string): T | null {\n        return (\n            this.options.find((item) =>\n                this.matcher?.(item, value, this.itemsHandlers.stringify()),\n            ) ?? null\n        );\n    }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}